<!DOCTYPE html>

<html lang="it" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>MDDM ELEKTRISCH</title>
    <link rel="stylesheet" href="prova.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <h1 id="finale">
        <div id="homes">
            <button><img class="size" src="Home.png" />Home</button>
            <button onclick="googleTranslateElementInit()">Language</button>
            <button onclick="logout()">Logout</button>
            <button class="pr" id="usernameDisplay">ok</button>
        </div>
        <div id="google_translate_element"></div>
    </h1>


    <div class="wrapper">
        <div class="contenitore">
            <div class="descrizione">
                <p>Met ruim zes jaar ervaring in standaard (woning)installaties en tientallen tevreden klanten, kunt u nu de door u gewenste installaties direct online bestellen. In de industriële sector wordt samengewerkt met partners op het gebied van klimaattechnologieën. Wij hebben werkzaamheden uitgevoerd voor hcrt Regeltechniek & Klimaattechniek, Abs Klimaattechniek, Warmtebouw bv, ULC Regeltechniek & Klimaattechniek, Celcius bv.</p>
            </div>
            <div class="griglia-immagine">
                <div class="quadrante" data-id="1">
                    <h3> 1 Patch:<br />-Installatie van stopcontacten en kabels <br />-Uitbreiding zekeringpaneel <br />-Installatie van binnen- en buitenverlichting </h3>
                </div>
                <div class="quadrante" data-id="2">
                    <h4> 2 Patch <br />Perilex Connection<br />Elektrische renovatie<br />Schakelaars en bedrading<br />Elektrische problemen</h4>
                </div>
                <div class="quadrante" data-id="3">
                    <h5>Kortsluitdetectie<br />Installatie van laadstations</h5>
                </div>
                <div class="quadrante" data-id="4">
                    <h5>Elektrische stroom toepassen</h5>
                </div>
                <div class="quadrante" data-id="5"><h5>Installatie van het elektrische paneel</h5></div>
                <div class="quadrante" data-id="6"><h5>Ontwerp van elektrische installaties</h5></div>
                <div class="quadrante" data-id="7"><h5>Bekabeling en installatie van datakabels</h5></div>
                <div class="quadrante" data-id="8"><h5>Elektrische installatie van ventilatie- en verwarmingssystemen</h5></div>
                <div class="quadrante" data-id="9"></div>
            </div>
        </div>
        <div class="contenitore">
            <div class="descrizione">
                <p>&lt;----- order your feature <br /> contact us att<br /> e-mail: mddmelektrisch@gmail.com <br />phone: 0634175308</p>
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll(".quadrante").forEach(div => {
            div.addEventListener("click", () => {
                const id = div.dataset.id;
                //alert("Hai cliccato sul quadrante " + id);
                // Puoi fare anche: window.location.href = `dettaglio.html?id=${id}`;
            });
        });
    </script>


    <script>
        window.onload = async () => {
            // 🌍 Imposta la lingua se già salvata
            const savedLang = localStorage.getItem("selectedLanguage");
            if (savedLang) {
                changeLanguage(savedLang);
            }

            // 🔐 Controlla il token
            const token = localStorage.getItem("token");
            if (!token) {
                alert("Devi prima accedere!");
                window.location.href = "pagina.html";
                return;
            }

            // ✅ Prendi dati utente e mostra il nome
            try {
                const res = await fetch("https://mddmelektrisch.onrender.com/me", {
                    method: "GET",
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                });

                if (!res.ok) throw new Error("Token non valido o scaduto");

                const data = await res.json();
                document.getElementById("usernameDisplay").innerText = data.username;
            } catch (err) {
                alert(err.message);
                localStorage.removeItem("token");
                window.location.href = "pagina.html";
            }
        };

        // 🔁 Cambia lingua se selezionata
        function changeLanguage(lang) {
            const selectField = document.querySelector(".goog-te-combo");
            if (selectField) {
                selectField.value = lang;
                selectField.dispatchEvent(new Event("change"));
                localStorage.setItem("selectedLanguage", lang);
            }
        }
    </script>


    <script>
        const token = localStorage.getItem("token");
        if (!token) window.location.href = "login.html";

        async function getUserData() {
            const res = await fetch("https://mddmelektrisch.onrender.com/me", {
                headers: { "Authorization": "Bearer " + token }
            });

            const data = await res.json();
            if (!data.username) {
                alert("Sessione non valida");
                window.location.href = "pagina.html";
            }

        }

        getUserData();

        function logout() {
            localStorage.removeItem("token");
            window.location.href = "pagina.html";
        }
    </script>
    <script src="code.js"></script>

    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'it',
                includedLanguages: 'en,es,fr,de',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }

        // Funzione per cambiare lingua
        function changeLanguage(lang) {
            const selectField = document.querySelector(".goog-te-combo");
            if (selectField) {
                selectField.value = lang;
                selectField.dispatchEvent(new Event("change"));
                localStorage.setItem("selectedLanguage", lang);  // 🔥 Salva nel localStorage
            }
        }
    </script>

    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({ pageLanguage: 'it' }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>



    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        emailjs.init('A8DlaPczgL56ps21a');

        document.querySelectorAll('.quadrante').forEach(function (quadrante) {
            quadrante.addEventListener('click', function () {
                const id = this.getAttribute('data-id');
                const descrizione = this.innerText.trim();

                Swal.fire({
                    title: `Order ${descrizione}`,
                    html: `
                            <input type="text" id="nome" placeholder="User name"><br><br>
                            <input type="email" id="email" placeholder="email"><br><br>
                            <textarea id="quantita" placeholder="Description" rows="4"></textarea><br><br>
                        `,
                    showCancelButton: true,
                    confirmButtonText: 'Invia ordine',
                    preConfirm: () => {
                        const nome = document.getElementById('nome').value;
                        const email = document.getElementById('email').value;
                        const quantita = document.getElementById('quantita').value;
                        if (!nome || !email || !quantita) {
                            Swal.showValidationMessage('Insert all data');
                            return false;
                        }
                        return { nome, email, quantita, prodotto: descrizione, id };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        const params = {
                            name: result.value.nome,
                            email: result.value.email,
                            message: `Order n° ${result.value.id} - ${result.value.prodotto}\n\nDettagli: ${result.value.quantita}`
                        };

                        emailjs.send("service_kd2k8sm", "template_egpm2rn", params)
                            .then(() => {
                                Swal.fire("Order done!", "", "success");
                            }, (err) => {
                                Swal.fire("Error", "Contact us to email.", "error");
                                console.error(err);
                            });
                    }
                });
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>